<!DOCTYPE html>
<html>
<head>
    <title>IP Address World Map</title>
    <!-- Leaflet CSS/JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <!-- Echarts -->
    <script src="https://cdn.bootcdn.net/ajax/libs/echarts/5.0.2/echarts.common.js"></script>
</head>
<body>
    <div id="world-chart" style="width: 100%; height: 400px;"></div>
    <div id="china-chart" style="width: 100%; height: 400px;"></div>

    <script>
        
        // 初始化全球柱状图
        const worldChart = echarts.init(document.getElementById('world-chart'));
        const worldOption = {
            title: {
                text: '全球 IP 分布',
                left: 'center'
            },
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'shadow'
                }
            },
            xAxis: {
                type: 'category',
                data: []
            },
            yAxis: {
                type: 'value'
            },
            series: [{
                data: [],
                type: 'bar'
            }]
        };

        // 初始化中国柱状图
        const chinaChart = echarts.init(document.getElementById('china-chart'));
        const chinaOption = {
            title: {
                text: '中国 IP 分布',
                left: 'center'
            },
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'shadow'
                }
            },
            xAxis: {
                type: 'category',
                data: []
            },
            yAxis: {
                type: 'value'
            },
            series: [{
                data: [],
                type: 'bar'
            }]
        };

        // 获取全球数据
        fetch('/get_world_data/')
            .then(response => response.json())
            .then(data => {
                if (data.status) {
                    worldOption.xAxis.data = data.data.countries;
                    worldOption.series[0].data = data.data.counts;
                    worldChart.setOption(worldOption);
                }
            });

        // 获取中国数据
        fetch('/get_china_data/')
            .then(response => response.json())
            .then(data => {
                if (data.status) {
                    chinaOption.xAxis.data = data.data.cities;
                    chinaOption.series[0].data = data.data.counts;
                    chinaChart.setOption(chinaOption);
                }
            });
    </script>
</body>
</html>